<!DOCTYPE html>
<html lang="en">
<head>

<!-- ===== BASIC META ===== -->
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>AETHER ‚Äì Real-Time Particle Simulation Engine | GI28 Ultimate</title>

<meta name="description" content="AETHER by GI28 is a high-fidelity real-time particle simulation engine. Convert text, images, video, or webcam input into interactive particle art. Export PNG & record sessions instantly.">
<meta name="keywords" content="Aether Engine, Particle Simulation Web App, Text to Particles, Image to Particle Effect, Real-time Canvas Engine, GI28 Aether, Creative Coding Tool">
<meta name="author" content="Abrar Khan ‚Äì GI28">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<meta name="googlebot" content="index, follow">
<meta name="geo.region" content="IN">
<meta name="geo.placename" content="India">

<!-- ===== CANONICAL ===== -->
<link rel="canonical" href="https://gi28.in/Aether/">

<!-- ===== OPEN GRAPH ===== -->
<meta property="og:type" content="website">
<meta property="og:title" content="AETHER ‚Äì Real-Time Particle Simulation Engine">
<meta property="og:description" content="Turn text, images, video & webcam into stunning interactive particle simulations. Built by GI28.">
<meta property="og:url" content="https://gi28.in/Aether/">
<meta property="og:site_name" content="GI28 Ultimate">
<meta property="og:image" content="https://gi28.in/assets/aether-preview.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:locale" content="en_IN">

<!-- ===== TWITTER CARD ===== -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="AETHER ‚Äì Particle Simulation Web App">
<meta name="twitter:description" content="Interactive real-time particle engine. Export snapshots & record sessions.">
<meta name="twitter:image" content="https://gi28.in/assets/aether-preview.jpg">

<!-- ===== PERFORMANCE ===== -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="//fonts.googleapis.com">

<!-- ===== FAVICON ===== -->
<link rel="icon" type="image/png" href="/favicon.png">
<link rel="apple-touch-icon" href="/favicon.png">

<!-- ===== PWA STYLE ===== -->
<meta name="theme-color" content="#030304">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- ===== SECURITY ===== -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: blob: data: 'unsafe-inline' 'unsafe-eval';">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
<meta http-equiv="X-Content-Type-Options" content="nosniff">

<!-- ===== STRUCTURED DATA (WEB APPLICATION SCHEMA) ===== -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "AETHER ‚Äì GI28 Ultimate",
  "applicationCategory": "MultimediaApplication",
  "operatingSystem": "Web Browser",
  "url": "https://gi28.in/Aether/",
  "description": "A high-performance real-time particle simulation engine supporting text, image, video and webcam input.",
  "creator": {
    "@type": "Person",
    "name": "Abrar Khan"
  },
  "publisher": {
    "@type": "Organization",
    "name": "GI28",
    "url": "https://gi28.in/"
  },
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "INR"
  }
}
</script>

<!-- ===== FONTS ===== -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
/* --- CORE VARIABLES --- */
:root {
    --bg: #030304;
    --primary: #00f2ff;
    --secondary: #bd00ff;
    --glass-panel: rgba(15, 15, 20, 0.85);
    --glass-border: rgba(255, 255, 255, 0.12);
    --text: #ffffff;
    --text-muted: #8b9bb4;
    --font-main: 'Inter', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
}

/* --- RESET & BASE --- */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

html, body {
    margin: 0; padding: 0;
    background-color: var(--bg);
    color: var(--text);
    font-family: var(--font-main);
    width: 100%;
}

/* DEFAULT STATE: LOCKED (APP MODE) */
body {
    height: 100vh;
    overflow: hidden; /* No Scroll */
    position: fixed; /* Fixes iOS Bounce */
}

/* SCROLL STATE: UNLOCKED (WEBSITE MODE) */
body.scroll-active {
    height: auto;
    overflow-y: auto; /* Allow Scroll */
    position: static; /* Release Fixed Position */
}

/* Custom Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }

/* --- CANVAS LAYER --- */
canvas#canvas1 { 
    display: block; position: fixed; top: 0; left: 0; 
    width: 100%; height: 100%; 
    z-index: 0; 
    /* CRITICAL: Default to none to catch particles */
    touch-action: none; 
    transition: opacity 0.5s ease;
}

/* CRITICAL FIX: When Scrolling, let touches pass through Canvas */
body.scroll-active canvas#canvas1 {
    pointer-events: none; /* Mouse/Touch goes through canvas to body */
    touch-action: auto;   /* Browser handles scrolling */
    opacity: 0.4;         /* Dim it slightly */
}

/* --- BOOT LOADER --- */
#boot-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #050505; z-index: 9999;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-family: var(--font-mono);
    transition: opacity 0.8s ease-out, visibility 0.8s;
}
.boot-container { width: 300px; text-align: center; }
.boot-logo { 
    font-size: 24px; font-weight: 800; letter-spacing: 4px; margin-bottom: 20px; 
    color: var(--text); text-shadow: 0 0 15px rgba(255,255,255,0.3);
}
.boot-logo span { color: var(--primary); }
.progress-bar-track {
    width: 100%; height: 2px; background: rgba(255,255,255,0.1);
    margin-bottom: 10px; position: relative; overflow: hidden;
}
.progress-bar-fill {
    position: absolute; left: 0; top: 0; height: 100%; width: 0%;
    background: var(--primary);
    box-shadow: 0 0 10px var(--primary);
}
.boot-text { font-size: 10px; color: var(--primary); text-align: left; opacity: 0.8; }
.loaded #boot-screen { opacity: 0; visibility: hidden; pointer-events: none; }

/* --- HEADER --- */
.top-header {
    position: fixed; top: 0; left: 0; width: 100%;
    padding: 20px 30px;
    display: flex; justify-content: space-between; align-items: center;
    z-index: 800; pointer-events: none;
}
.brand {
    font-family: var(--font-mono); font-weight: 800; font-size: 16px;
    letter-spacing: 2px; color: var(--text);
    display: flex; align-items: center; gap: 10px;
    pointer-events: auto; text-shadow: 0 0 10px rgba(0, 242, 255, 0.4);
}
.brand span { color: var(--primary); }

.menu-trigger {
    pointer-events: auto; cursor: pointer;
    font-size: 24px; color: white;
    width: 40px; height: 40px;
    display: flex; align-items: center; justify-content: center;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--glass-border);
    border-radius: 8px; backdrop-filter: blur(5px);
    transition: 0.2s;
}
.menu-trigger:hover, .menu-trigger.active {
    background: var(--primary); color: black; border-color: var(--primary);
}

/* --- POPUP MENU --- */
.popup-menu {
    position: fixed; top: 70px; right: 30px; width: 220px;
    background: var(--glass-panel);
    backdrop-filter: blur(25px);
    border: 1px solid var(--glass-border);
    border-radius: 12px; padding: 10px;
    display: flex; flex-direction: column; gap: 5px;
    z-index: 801;
    transform: scale(0.9); opacity: 0; pointer-events: none;
    transition: 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 15px 40px rgba(0,0,0,0.5);
}
.popup-menu.show { transform: scale(1); opacity: 1; pointer-events: auto; }
.popup-item {
    padding: 12px 16px; font-family: var(--font-mono); font-size: 12px;
    color: var(--text-muted); text-decoration: none; border-radius: 6px;
    display: flex; justify-content: space-between; align-items: center;
}
.popup-item:hover { background: rgba(255,255,255,0.08); color: white; }
.popup-divider { height: 1px; background: rgba(255,255,255,0.1); margin: 5px 0; }

/* --- DOCK --- */
.dock-container {
    position: fixed; bottom: 30px; left: 0; width: 100%;
    display: flex; justify-content: center; z-index: 1000;
    pointer-events: none;
    transition: bottom 0.3s;
}
/* Move dock up when scrolling to avoid covering content */
body.scroll-active .dock-container { position: fixed; bottom: 20px; } 

.dock {
    pointer-events: auto;
    background: rgba(10, 10, 12, 0.8);
    backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid var(--glass-border);
    padding: 10px 20px; border-radius: 24px;
    display: flex; align-items: center; gap: 15px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.6);
    transition: transform 0.3s;
}
.dock-item {
    width: 44px; height: 44px; border-radius: 12px;
    background: rgba(255,255,255,0.05);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; position: relative;
}
.dock-item svg { width: 22px; fill: white; opacity: 0.8; }
.dock-item.active { background: var(--primary); box-shadow: 0 0 15px var(--primary); }
.dock-item.active svg { fill: black; }
.dock-separator { width: 1px; height: 24px; background: rgba(255,255,255,0.1); }
.dock-item::after {
    content: attr(data-tooltip); position: absolute; top: -35px; left: 50%; 
    transform: translateX(-50%); background: black; padding: 4px 8px; 
    border-radius: 4px; font-size: 10px; font-family: var(--font-mono);
    opacity: 0; pointer-events: none; white-space: nowrap; border: 1px solid var(--glass-border);
}
.dock-item:hover::after { opacity: 1; top: -45px; }

/* --- CONTENT WRAPPER --- */
.content-wrapper {
    position: relative;
    top: 100vh; /* Pushes content below the initial fold */
    width: 100%;
    z-index: 10;
    background: linear-gradient(to bottom, rgba(3,3,4,0) 0%, #030304 20%);
    display: none; /* Hidden by default */
}
body.scroll-active .content-wrapper { display: block; }

.content-section { max-width: 900px; margin: 0 auto; padding: 0 20px 120px 20px; }
.info-card {
    background: rgba(20, 20, 25, 0.6); border: 1px solid var(--glass-border);
    backdrop-filter: blur(10px); border-radius: 16px; padding: 30px; 
    margin-bottom: 30px; position: relative; overflow: hidden;
}
.info-card::before { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: var(--secondary); }
.info-card h2 { margin-top: 0; color: var(--primary); font-family: var(--font-mono); font-size: 18px; }
.info-card p { line-height: 1.6; color: #ccc; font-size: 14px; }

/* Ad/Sponsor Slots */
.ad-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px; }
.ad-slot {
    height: 200px; border: 1px dashed var(--glass-border);
    background: rgba(255,255,255,0.02); border-radius: 8px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: var(--text-muted); font-family: var(--font-mono); font-size: 11px;
}

/* --- SETTINGS PANEL --- */
.panel {
    position: fixed; top: 80px; right: 30px;
    width: 320px; max-height: calc(100vh - 150px);
    background: var(--glass-panel); backdrop-filter: blur(30px);
    border: 1px solid var(--glass-border); border-radius: 16px; z-index: 900;
    display: flex; flex-direction: column; transition: 0.3s;
}
.panel.hidden { opacity: 0; pointer-events: none; transform: translateX(30px); }
.panel-header {
    padding: 16px; border-bottom: 1px solid var(--glass-border);
    display: flex; justify-content: space-between; align-items: center;
    font-weight: 800; font-size: 12px; color: var(--primary);
}
.panel-content { padding: 20px; overflow-y: auto; }
.control-row { margin-bottom: 15px; }
.control-row label { display: block; font-size: 11px; color: #ccc; margin-bottom: 8px; font-family: var(--font-mono); }
input[type="range"] { width: 100%; -webkit-appearance: none; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; }
input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--primary); border-radius: 50%; }
input[type="text"], select { width: 100%; background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border); color: white; padding: 10px; border-radius: 6px; }
.button-grid { display: flex; gap: 8px; margin-bottom: 10px; }
.btn, .btn-small { flex: 1; padding: 10px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: white; border-radius: 6px; font-size: 11px; font-weight: 600; }
.btn.active { background: var(--primary); color: black; border-color: var(--primary); }

/* --- HUD & HELPERS --- */
.hud-stats { position: fixed; top: 80px; left: 30px; font-family: var(--font-mono); font-size: 10px; color: var(--text-muted); pointer-events: none; z-index: 500; }
.hidden { display: none !important; }
#rec-indicator { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(255,0,0,0.2); border: 1px solid red; color: red; padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: bold; display: flex; align-items: center; gap: 6px; z-index: 500; }
.red-dot { width: 6px; height: 6px; background: red; border-radius: 50%; animation: blink 1s infinite; }
@keyframes blink { 50% { opacity: 0.2; } }

@media (max-width: 768px) {
    .panel, .popup-menu { right: 5%; width: 90%; }
    .top-header { padding: 15px 20px; }
}
    </style>
</head>
<body>

    <div id="boot-screen">
        <div class="boot-container">
            <div class="boot-logo">GI28 <span>AETHER</span></div>
            <div class="progress-bar-track">
                <div class="progress-bar-fill" id="boot-fill"></div>
            </div>
            <div class="boot-text" id="boot-log">INITIALIZING DOTS...</div>
        </div>
    </div>

    <canvas id="canvas1"></canvas>
    
    <header class="top-header">
        <div class="brand">
             GI28 <span>AETHER</span>
        </div>
        <div class="menu-trigger" onclick="ui.toggleMenu(this)">‚ò∞</div>
    </header>

    <div class="popup-menu" id="popupMenu">
        <a href="https://gi28.in/" class="popup-item" onclick="ui.closeMenu()">
            HOME <span>[gi28]</span>
        </a>
        <a href="" class="popup-item" onclick="ui.closeMenu(); ui.toggleScroll(true)">
            ABOUT THIS PAGE <span>Info</span>
        </a>
        <div class="popup-divider"></div>
        <a href="https://gi28.in/Tools/" class="popup-item">ALL TOOLS <span>Hub</span></a>
        <a href="https://constabrar.in/" class="popup-item">ABOUT Constant Abrar<span>Developer</span></a>
        <a href="https://gi28.in/Contact/" class="popup-item">CONTACT <span>24/7</span></a>
        <div style="padding: 10px 16px; font-size: 9px; color: #555; text-align: right;">By Constant Abrar</div>
    </div>

    <div class="hud-stats">
        <span id="fps-stat">Exact Value</span> ‚Üí <span id="particle-stat">0 Particles</span>
    </div>
    <div id="rec-indicator" class="hidden"><div class="red-dot"></div> REC <span id="rec-time">00:00</span></div>

    <div id="settings-panel" class="panel hidden" onclick="event.stopPropagation()">
        <div class="panel-header">
            <span><span>‚öôÔ∏è</span> ENGINE CONFIGURATION</span>
            <button class="close-btn" onclick="ui.toggleSettings()" style="background:none;border:none;color:white;font-size:18px;">√ó</button>
        </div>
        <div class="panel-content">
            <div class="section-title">INPUT SOURCE</div>
            <div class="button-grid">
                <button class="btn active" onclick="app.setMode('text', this)">Text</button>
                <button class="btn" onclick="app.setMode('image', this)">Image</button>
                <button class="btn" onclick="app.setMode('video', this)">Video</button>
                <button class="btn" onclick="app.setMode('cam', this)">Webcam</button>
            </div>
            <div id="input-text-container" class="control-row">
                <input type="text" id="textInput" value="AETHER" placeholder="Type something..." onkeyup="if(event.key === 'Enter') app.refresh()">
                <button class="btn-small" onclick="app.refresh()" style="width: 100%; margin-top:5px;">Update Render</button>
            </div>
            <div id="input-file-container" class="control-row hidden">
                <input type="file" id="fileInput" style="display:none;" accept="image/*,video/*">
                <label for="fileInput" class="btn" style="display:block; text-align:center; padding:12px;">üìÇ Select Media</label>
            </div>

            <div class="section-title">PHYSICS</div>
            <div class="control-row">
                <label>Particle Density</label>
                <input type="range" id="gap" min="3" max="20" value="4" oninput="app.updateConfig('gap', this.value)">
            </div>
            <div class="control-row">
                <label>Particle Size</label>
                <input type="range" id="size" min="0.5" max="10" value="1.5" step="0.1" oninput="app.updateConfig('baseSize', this.value)">
            </div>
            
            <div class="section-title">VISUALS</div>
            <div class="control-row">
                <label>Shape</label>
                <select id="shapeSelect" onchange="app.updateConfig('shape', this.value)">
                    <option value="circle">Circle</option>
                    <option value="square">Square</option>
                    <option value="pentagon">Pentagon</option>
                    <option value="line">Line Wireframe</option>
                </select>
            </div>
            <div class="control-row">
                <label>Color Mode</label>
                <select onchange="app.updateConfig('colorMode', this.value)">
                    <option value="solid">Solid White</option>
                    <option value="original">Source Color</option>
                    <option value="gradient">Cyber Gradient</option>
                </select>
            </div>

            <div class="section-title">INTERACTION</div>
            <div class="button-grid">
                <button class="btn active" id="mode-repulse" onclick="app.setInteraction('repulse')">Push</button>
                <button class="btn" id="mode-attract" onclick="app.setInteraction('attract')">Pull</button>
                <button class="btn" id="mode-bubble" onclick="app.setInteraction('bubble')">Bubble</button>
            </div>
            <div class="control-row">
                <label>Interaction Radius</label>
                <input type="range" min="1000" max="10000" value="3000" step="500" oninput="app.updateConfig('mouseRadius', this.value)">
            </div>
        </div>
    </div>

    <div class="dock-container">
        <div class="dock">
            <div class="dock-item" id="scroll-toggle" onclick="ui.toggleScroll()" data-tooltip="Unlock View">
                <svg id="icon-lock" viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>
                <svg id="icon-unlock" class="hidden" viewBox="0 0 24 24"><path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm0 12H6V10h12v10z"/></svg>
            </div>
            <div class="dock-separator"></div>
            <div class="dock-item" onclick="ui.toggleSettings()" data-tooltip="Config">
                <svg viewBox="0 0 24 24"><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"></path></svg>
            </div>
            <div class="dock-item" onclick="app.export('png')" data-tooltip="Snapshot">
                <svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"></path></svg>
            </div>
            <div class="dock-item" id="dock-rec" onclick="app.toggleRecord()" data-tooltip="Record">
                <svg viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"></path></svg>
            </div>
            <div class="dock-separator"></div>
            <div class="dock-item" onclick="app.randomize()" data-tooltip="Surprise Me">
               <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"></path></svg>
            </div>
        </div>
    </div>

    <div style="display:none;">
        <canvas id="helperCanvas"></canvas>
        <video id="helperVideo" loop muted playsinline crossorigin="anonymous"></video>
    </div>

    <div class="content-wrapper">
        <section class="content-section">
            <div class="info-card">
                <h2>GI28 AETHER ENGINE</h2>
                <p>Aether is a high-fidelity real-time particle simulation engine. Designed for creative coders and digital artists, it supports complex physics interactions including repulsion fields, attraction wells, and bubble distortion algorithms.</p>
                <p>Use the dock controls to record your session or snapshot high-resolution renders.</p>
            </div>
            <div class="info-card" style="border-left-color: var(--primary);">
                <h2>PARTNER SHOWCASE</h2>
                <div class="ad-grid">
                    <div class="ad-slot"><span style="border:1px solid #333; padding:2px 6px; margin-bottom:10px;">ADVERTISEMENT</span><span>SLOT A</span></div>
                    <div class="ad-slot"><span style="border:1px solid #333; padding:2px 6px; margin-bottom:10px;">ADVERTISEMENT</span><span>SLOT B</span></div>
                    <div class="ad-slot"><span style="color:var(--primary)">FEATURED TOOL</span><span>GI28 SPECTRA</span></div>
                </div>
            </div>
            <div style="text-align: center; color: var(--text-muted); font-size: 10px; margin-top: 50px; font-family: var(--font-mono);">
                ¬©2026 gi28 ‚Ä¢ By Constant Abrar
            </div>
        </section>
    </div>

    <script>
/**
 * AETHER STUDIO - MOBILE FIX v3.2
 */

const ui = {
    isScrollable: false,

    init: () => {
        ui.bootSequence();
    },

    bootSequence: () => {
        const fill = document.getElementById('boot-fill');
        const log = document.getElementById('boot-log');
        let width = 0;
        const interval = setInterval(() => {
            width += Math.random() * 8;
            if(width > 100) width = 100;
            fill.style.width = width + '%';
            if(width === 100) {
                clearInterval(interval);
                setTimeout(() => document.body.classList.add('loaded'), 500);
            }
        }, 50);
    },

    toggleSettings: () => {
        document.getElementById('settings-panel').classList.toggle('hidden');
        ui.closeMenu();
    },

    toggleMenu: (btn) => {
        const menu = document.getElementById('popupMenu');
        menu.classList.toggle('show');
        if(btn) btn.classList.toggle('active');
        document.getElementById('settings-panel').classList.add('hidden');
    },

    closeMenu: () => {
        document.getElementById('popupMenu').classList.remove('show');
        document.querySelector('.menu-trigger').classList.remove('active');
    },

    toggleScroll: (forceState = null) => {
        const dockBtn = document.getElementById('scroll-toggle');
        const lockIcon = document.getElementById('icon-lock');
        const unlockIcon = document.getElementById('icon-unlock');
        
        if (forceState !== null) ui.isScrollable = forceState;
        else ui.isScrollable = !ui.isScrollable;

        if (ui.isScrollable) {
            // UNLOCKED: Allow scroll
            document.body.classList.add('scroll-active');
            dockBtn.classList.add('active');
            dockBtn.setAttribute('data-tooltip', 'Lock View');
            lockIcon.classList.add('hidden');
            unlockIcon.classList.remove('hidden');
            window.scrollTo({ top: window.innerHeight * 0.2, behavior: 'smooth' });
        } else {
            // LOCKED: App Mode
            document.body.classList.remove('scroll-active');
            dockBtn.classList.remove('active');
            dockBtn.setAttribute('data-tooltip', 'Unlock View');
            lockIcon.classList.remove('hidden');
            unlockIcon.classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }
};

const canvas = document.getElementById('canvas1');
const ctx = canvas.getContext('2d', { willReadFrequently: true });
const helperCanvas = document.getElementById('helperCanvas');
const helperCtx = helperCanvas.getContext('2d', { willReadFrequently: true });
const helperVideo = document.getElementById('helperVideo');

const config = {
    gap: 4, baseSize: 1.5, friction: 0.90, ease: 0.1,
    gravityX: 0, gravityY: 0, mouseRadius: 3000,
    interaction: 'repulse', shape: 'circle', colorMode: 'solid',
    width: window.innerWidth, height: window.innerHeight
};

let particles = [];
let sourceMode = 'text';
let mediaSource = null;
let frameCount = 0;
const mouse = { x: 0, y: 0, isActive: false };

class Particle {
    constructor(x, y, color) {
        this.originX = x; this.originY = y;
        this.x = Math.random() * config.width; this.y = Math.random() * config.height;
        this.vx = 0; this.vy = 0;
        this.color = color; this.hue = Math.random() * 360;
    }
    update() {
        // If scrolling, skip interaction calculation to save CPU and allow smooth scroll
        if (!ui.isScrollable && mouse.isActive) {
            const dx = mouse.x - this.x;
            const dy = mouse.y - this.y;
            const distSq = dx * dx + dy * dy;
            if (distSq < config.mouseRadius) {
                const force = (config.mouseRadius - distSq) / config.mouseRadius;
                const angle = Math.atan2(dy, dx);
                const power = force * 20;
                if (config.interaction === 'repulse') {
                    this.vx -= Math.cos(angle) * power;
                    this.vy -= Math.sin(angle) * power;
                } else if (config.interaction === 'attract') {
                    this.vx += Math.cos(angle) * power;
                    this.vy += Math.sin(angle) * power;
                } else if (config.interaction === 'bubble') {
                    this.x -= Math.cos(angle) * 5;
                    this.y -= Math.sin(angle) * 5;
                }
            }
        }
        this.vx += (this.originX - this.x) * config.ease;
        this.vy += (this.originY - this.y) * config.ease;
        this.vx *= config.friction; this.vy *= config.friction;
        this.x += this.vx; this.y += this.vy;
    }
    draw() {
        if(this.x < -50 || this.x > config.width+50 || this.y < -50 || this.y > config.height+50) return;
        let s = config.baseSize;
        if (config.colorMode === 'gradient') { ctx.fillStyle = `hsl(${this.hue}, 100%, 50%)`; this.hue+=2; }
        else ctx.fillStyle = this.color;
        
        ctx.beginPath();
        if (config.shape === 'circle') ctx.arc(this.x, this.y, s, 0, Math.PI * 2);
        else if (config.shape === 'square') { ctx.fillRect(this.x, this.y, s*2, s*2); return; }
        else if (config.shape === 'line') {
            ctx.strokeStyle = ctx.fillStyle; ctx.lineWidth = s;
            ctx.moveTo(this.x, this.y); ctx.lineTo(this.x - this.vx * 2, this.y - this.vy * 2); ctx.stroke(); return;
        } else {
             for(let i=0; i<5; i++) ctx.lineTo(this.x + s * Math.cos(i * 2 * Math.PI / 5), this.y + s * Math.sin(i * 2 * Math.PI / 5));
        }
        ctx.fill();
    }
}

const app = {
    activeStream: null,
    init: () => {
        app.resize();
        window.addEventListener('resize', app.resize);
        app.setupInputs();
        app.refresh();
        app.animate();
        ui.init();
    },
    resize: () => {
        config.width = window.innerWidth; config.height = window.innerHeight;
        canvas.width = config.width; canvas.height = config.height;
        helperCanvas.width = config.width; helperCanvas.height = config.height;
        app.processMedia(true); 
    },
    setupInputs: () => {
        const updateMouse = (e) => {
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            mouse.x = cx; mouse.y = cy; mouse.isActive = true;
        };
        window.addEventListener('mousemove', updateMouse);
        window.addEventListener('touchmove', (e) => { 
            // VITAL: Only prevent default if we are LOCKED (App mode). 
            // If scrollable, let the event Bubble up.
            if(!ui.isScrollable) {
                e.preventDefault(); 
            }
            updateMouse(e);
        }, {passive: false});
        window.addEventListener('touchend', () => mouse.isActive = false);
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;
            const url = URL.createObjectURL(file);
            if(file.type.startsWith('image')) {
                const img = new Image(); img.onload = () => { mediaSource = img; app.refresh(); }; img.src = url;
            } else if(file.type.startsWith('video')) {
                helperVideo.src = url; helperVideo.play(); mediaSource = helperVideo;
                helperVideo.onloadeddata = () => app.refresh();
            }
        });
    },
    refresh: () => {
        if(sourceMode === 'text') app.processText();
        else app.processMedia();
    },
    processText: () => {
        let text = document.getElementById('textInput').value.trim();
        if(text === '') text = 'AETHER';
        const fontSize = Math.min(config.width * 0.18, 250);
        helperCtx.clearRect(0,0, config.width, config.height);
        helperCtx.font = `900 ${fontSize}px Inter, sans-serif`;
        helperCtx.textAlign = 'center'; helperCtx.textBaseline = 'middle';
        helperCtx.fillStyle = 'white'; helperCtx.fillText(text, config.width/2, config.height/2);
        app.scanParticles();
    },
    processMedia: (forceRescan = false) => {
        if(!mediaSource) return;
        helperCtx.clearRect(0,0, config.width, config.height);
        const mw = mediaSource.videoWidth || mediaSource.naturalWidth || 1; 
        const mh = mediaSource.videoHeight || mediaSource.naturalHeight || 1;
        const ratio = Math.max(config.width / mw, config.height / mh);
        const dw = mw * ratio; const dh = mh * ratio;
        helperCtx.drawImage(mediaSource, (config.width-dw)/2, (config.height-dh)/2, dw, dh);
        if(sourceMode !== 'video' && sourceMode !== 'cam' || forceRescan || particles.length === 0) app.scanParticles();
    },
    scanParticles: () => {
        particles = [];
        const pixels = helperCtx.getImageData(0,0, config.width, config.height).data;
        let gap = parseInt(config.gap); if(gap < 2) gap = 2;
        const estParticles = (config.width * config.height) / (gap * gap);
        if(estParticles > 40000) {
            gap = Math.ceil(Math.sqrt((config.width * config.height) / 30000));
            document.getElementById('gap').value = gap; config.gap = gap;
        }
        for(let y=0; y<config.height; y+=gap) {
            for(let x=0; x<config.width; x+=gap) {
                const idx = (y * config.width + x) * 4;
                if(pixels[idx+3] > 128) {
                    const col = `rgb(${pixels[idx]}, ${pixels[idx+1]}, ${pixels[idx+2]})`;
                    particles.push(new Particle(x, y, col));
                }
            }
        }
        document.getElementById('particle-stat').innerText = `${particles.length} Particles`;
    },
    updateColors: () => {
        if(!mediaSource || frameCount % 4 !== 0) return;
        app.processMedia();
        const pixels = helperCtx.getImageData(0,0, config.width, config.height).data;
        particles.forEach(p => {
            const x = Math.floor(p.originX); const y = Math.floor(p.originY);
            if(x>=0 && x<config.width && y>=0 && y<config.height) {
                const idx = (y * config.width + x) * 4;
                p.color = `rgb(${pixels[idx]}, ${pixels[idx+1]}, ${pixels[idx+2]})`;
            }
        });
    },
    animate: () => {
        frameCount++;
        ctx.clearRect(0,0, config.width, config.height);
        if((sourceMode === 'video' || sourceMode === 'cam') && mediaSource) app.updateColors();
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(app.animate);
    },
    setMode: (mode, btn) => {
        if(app.activeStream) { app.activeStream.getTracks().forEach(track => track.stop()); app.activeStream = null; }
        sourceMode = mode;
        document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('input-text-container').classList.toggle('hidden', mode !== 'text');
        document.getElementById('input-file-container').classList.toggle('hidden', mode === 'text' || mode === 'cam');
        if(mode === 'cam') app.startCam();
        else if (mode === 'text') app.refresh();
        else { particles = []; document.getElementById('particle-stat').innerText = `0 Particles`; }
    },
    startCam: () => {
        navigator.mediaDevices.getUserMedia({video: true}).then(stream => {
            app.activeStream = stream; helperVideo.srcObject = stream;
            helperVideo.play(); mediaSource = helperVideo;
        }).catch(e => { alert("Camera access denied."); });
    },
    updateConfig: (key, val) => {
        if(key === 'gap') val = parseInt(val); else val = isNaN(val) ? val : parseFloat(val);
        config[key] = val; if(key === 'gap') app.refresh();
    },
    setInteraction: (mode) => {
        config.interaction = mode;
        document.querySelectorAll('[id^="mode-"]').forEach(b => b.classList.remove('active'));
        document.getElementById(`mode-${mode}`).classList.add('active');
    },
    randomize: () => {
        const rGap = Math.floor(Math.random()*6)+3;
        const rSize = Math.random()*3+0.5;
        document.getElementById('gap').value = rGap; config.gap = rGap;
        document.getElementById('size').value = rSize; config.baseSize = rSize;
        app.refresh();
    },
    export: () => {
        const link = document.createElement('a');
        link.download = `Aether_Snap_${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
    },
    recording: false, mediaRecorder: null, chunks: [],
    toggleRecord: () => {
        if(app.recording) {
            app.mediaRecorder.stop(); app.recording = false;
            document.getElementById('rec-indicator').classList.add('hidden');
            document.getElementById('dock-rec').classList.remove('active');
        } else {
            const stream = canvas.captureStream(60);
            const mimeOptions = ["video/webm; codecs=vp9", "video/webm", "video/mp4"];
            const mimeType = mimeOptions.find(type => MediaRecorder.isTypeSupported(type)) || "";
            try { app.mediaRecorder = new MediaRecorder(stream, { mimeType }); } 
            catch (e) { alert("Recording not supported."); return; }
            app.chunks = [];
            app.mediaRecorder.ondataavailable = e => app.chunks.push(e.data);
            app.mediaRecorder.onstop = e => {
                const blob = new Blob(app.chunks, { 'type' : mimeType || 'video/webm' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `Aether_Rec_${Date.now()}.webm`; a.click();
            };
            app.mediaRecorder.start(); app.recording = true;
            document.getElementById('rec-indicator').classList.remove('hidden');
            document.getElementById('dock-rec').classList.add('active');
        }
    }
};

app.init();
    </script>
</body>
</html>
